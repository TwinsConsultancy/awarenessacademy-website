<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InnerSpark - Course Introduction</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .intro-hero {
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            padding: 80px 20px 40px;
            text-align: center;
        }

        .intro-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            /* 16:9 */
            height: 0;
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            margin: 30px auto;
        }

        .video-wrapper video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .cta-section {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            margin-top: -50px;
            position: relative;
            z-index: 10;
        }

        .price-tag {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-saffron);
            margin: 20px 0;
        }

        .buy-btn {
            background: linear-gradient(135deg, #FF9933 0%, #FF512F 100%);
            color: white;
            padding: 18px 50px;
            font-size: 1.3rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            box-shadow: 0 10px 20px rgba(255, 81, 47, 0.3);
        }

        .buy-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(255, 81, 47, 0.4);
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar glass-effect">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <i class="fas fa-fire-alt"></i> InnerSpark
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="courses.html">Courses</a>
                <a href="login.html" class="btn-primary" id="navAuthBtn">Login</a>
            </div>
        </div>
    </nav>

    <main>
        <div id="loader" style="text-align: center; padding: 100px;">
            <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--color-saffron);"></i>
        </div>

        <div id="content" style="display: none;">

            <section class="intro-hero">
                <div class="intro-container">
                    <span class="badge badge-pending" id="courseCategory"
                        style="margin-bottom: 20px; display: inline-block;">Category</span>
                    <h1 id="courseTitle"
                        style="font-size: 3.5rem; margin-bottom: 20px; line-height: 1.2; background: linear-gradient(to right, #333, #666); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                        Loading...</h1>
                    <p id="courseIntro"
                        style="font-size: 1.2rem; color: #666; max-width: 800px; margin: 0 auto 40px; line-height: 1.6;">
                        ...
                    </p>

                    <div class="video-wrapper">
                        <video id="introPlayer" controls poster="../assets/video-placeholder.jpg">
                            <source src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>

                    <div class="cta-section glass-ultra">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                            <div style="text-align: left;">
                                <h3 style="margin: 0; color: #333;">Ready to begin your journey?</h3>
                                <div style="display: flex; gap: 20px; margin-top: 10px; color: #666;">
                                    <span><i class="fas fa-clock"></i> <span id="courseDuration">0 Weeks</span></span>
                                    <span><i class="fas fa-signal"></i> <span
                                            id="courseDifficulty">Beginner</span></span>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div class="price-tag" id="coursePrice">$0</div>
                                <button class="buy-btn" onclick="handleBuy()">Enroll Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section style="background: white; padding: 80px 20px;">
                <div class="intro-container">
                    <h2 style="text-align: center; margin-bottom: 50px; font-size: 2.5rem;">Course Curriculum</h2>

                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 40px;">
                        <div>
                            <div
                                style="background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05);">
                                <h3 style="margin-bottom: 20px;">What You Will Learn</h3>
                                <p id="courseDescription" style="line-height: 1.8; color: #555; white-space: pre-wrap;">
                                </p>
                            </div>
                        </div>
                        <div>
                            <div class="glass-card" style="padding: 25px;">
                                <h4 style="margin-bottom: 20px;">Your Mentors</h4>
                                <div id="mentorList">
                                    <!-- Mentors -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="../js/auth.js"></script>
    <script src="../js/ui.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('id');

        document.addEventListener('DOMContentLoaded', async () => {
            if (!courseId) {
                window.location.href = 'courses.html';
                return;
            }

            // Check Login for Nav
            const auth = Auth.checkAuth([], false); // Passive check
            if (auth && auth.user) {
                const btn = document.getElementById('navAuthBtn');
                btn.textContent = 'Dashboard';
                btn.href = auth.user.role === 'Student' ? 'student-dashboard.html' :
                    auth.user.role === 'Staff' ? 'staff-dashboard.html' : 'admin-dashboard.html';
                btn.style.background = '#333';
            }

            try {
                // Fetch public preview info
                const res = await fetch(`${Auth.apiBase}/courses/${courseId}/preview`);
                if (!res.ok) throw new Error('Failed to load course');

                const data = await res.json();
                renderPage(data);
            } catch (err) {
                console.error(err);
                document.getElementById('content').innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h2>Course Not Found</h2>
                        <a href="courses.html" class="btn-primary">Browse Courses</a>
                    </div>
                `;
                document.getElementById('loader').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            }
        });

        function renderPage(data) {
            const c = data.course; // Assuming API structure

            document.title = `${c.title} - InnerSpark`;
            document.getElementById('courseCategory').textContent = c.category;
            document.getElementById('courseTitle').textContent = c.title;
            document.getElementById('courseIntro').textContent = c.introText || c.description.substring(0, 150) + '...';
            document.getElementById('coursePrice').textContent = c.price > 0 ? `$${c.price}` : 'Free';
            document.getElementById('courseDuration').textContent = c.duration;
            document.getElementById('courseDifficulty').textContent = c.difficulty;
            document.getElementById('courseDescription').textContent = c.description;

            // Video
            const player = document.getElementById('introPlayer');
            if (c.introVideoUrl) {
                player.src = c.introVideoUrl;
                // Optional: Preview Duration logic (e.g. stop after X seconds if it's not the full video URL?)
                // Assuming introVideoUrl IS the trailer. No need to stop it. 
                // But just in case, we can use previewDuration for display "1 Min Preview"
            } else {
                player.poster = c.thumbnail || '../assets/video-placeholder.jpg';
            }

            // Mentors
            const mentorList = document.getElementById('mentorList');
            if (c.mentors && c.mentors.length > 0) {
                // mentors might be array of names string (from controller) or objects
                // courseController.getCoursePreview usually populates mentors
                // Let's assume name string or object with name
                // Check controller response structure.
                // In `courseController.js`: `mentor: ... join(', ')` for preview?
                // Let's check `courseController.getCoursePreview` logic in backend.
                // Step 135 edit showed `previews: previewModules` and other fields.

                // If getCoursePreview returns `mentor` string, I'll use that.
                if (data.course.mentor) {
                    mentorList.innerHTML = `<div style="font-weight:600;">${data.course.mentor}</div>`;
                }
            }

            document.getElementById('loader').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        function handleBuy() {
            const auth = Auth.checkAuth([], false);
            if (auth && auth.user) {
                // If logged in, go to payment/checkout
                // For now, redirect to dashboard or simulated payment
                if (confirm('Proceed to enrollment?')) {
                    // In real app, redirect to /payment.html?courseId=...
                    // For now, just simulate or go to dashboard
                    window.location.href = `student-dashboard.html?enroll=${courseId}`;
                }
            } else {
                // Not logged in -> Register/Login
                // Pass return URL
                window.location.href = `login.html?redirect=course-intro.html?id=${courseId}`;
            }
        }
    </script>
</body>

</html>